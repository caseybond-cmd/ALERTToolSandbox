<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALERT Nursing Risk Assessment Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.4.4/build/qrcode.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F0F9F9; }
        .category-critical { background-color: #DC2626; color: #FFFFFF; }
        .category-intensive-escalate { background-color: #F97316; color: #FFFFFF; }
        .category-intensive { background-color: #F59E0B; color: #1A202C; }
        .category-standard { background-color: #2DD4BF; color: #134E4A; }
        .category-single { background-color: #67E8F9; color: #164E63; }
        .header-gradient { background: linear-gradient(to right, #0D9488, #0F766E); }
        .final-score-bg { background-color: #134E4A; }
        .risk-item-selected-amber { background-color: #fef3c7 !important; border-left: 4px solid #f59e0b !important; padding-left: 8px; border-radius: 4px; }
        .risk-item-selected-amber::before { content: '⚠️'; color: #f59e0b; margin-right: 8px; font-weight: bold; }
        .risk-item-selected-critical { border-left: 4px solid #ef4444 !important; background-color: #fee2e2 !important; padding-left: 8px; border-radius: 4px; }
        .risk-item-selected-critical::before { content: '❗'; color: #ef4444; margin-right: 8px; font-weight: bold; }
        .module-bg-b { background-color: #f0f9ff; }
        .module-bg-d { background-color: #fffbeb; }
        .module-bg-e { background-color: #fef2f2; }
        .module-bg-f { background-color: #faf5ff; }
        .module-bg-g { background-color: #f5f3ff; }
        .patient-tabs-container { border-bottom: 1px solid #D1D5DB; }
        .patient-tab { position: relative; cursor: pointer; padding: 0.75rem 1rem; color: #4B5563; border: 1px solid transparent; border-bottom: none; border-top: 4px solid transparent; margin-bottom: -1px; display: flex; align-items: center; gap: 0.5rem; transition: all 0.2s ease-in-out; }
        .patient-tab:hover { background-color: #F3F4F6; }
        .patient-tab.active { border-color: #D1D5DB; color: #047857; font-weight: 600; background-color: #FFFFFF; }
        .patient-tab.active.risk-critical { border-top-color: #DC2626; }
        .patient-tab.active.risk-intensive-escalate { border-top-color: #F97316; }
        .patient-tab.active.risk-intensive { border-top-color: #F59E0B; }
        .patient-tab.active.risk-standard { border-top-color: #2DD4BF; }
        .patient-tab.active.risk-single { border-top-color: #67E8F9; }
        .delete-patient-btn { color: #9CA3AF; font-size: 1.1rem; line-height: 1; padding: 2px; border-radius: 99px; }
        .delete-patient-btn:hover { color: #DC2626; background-color: #FEE2E2; }
        .tab-score-badge { font-size: 0.7rem; font-weight: 700; color: white; padding: 2px 6px; border-radius: 8px; }
        .qr-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 100; }
        .qr-container { background: white; padding: 2rem; border-radius: 10px; text-align: center; }
        .mobile-only { display: none; }
        @media (max-width: 768px) {
            .desktop-only { display: none; }
            .mobile-only { display: block; }
            .main-content { padding: 1rem; }
        }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-8">

    <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-xl shadow-lg mb-6 p-4">
            <div class="flex justify-end items-center mb-3">
                <div class="flex items-center gap-2">
                    <button id="addPatientBtn" type="button" class="bg-teal-600 hover:bg-teal-700 text-white font-bold py-2 px-3 rounded-lg text-sm transition-colors">Add Patient</button>
                    <button id="clearDataBtn" type="button" class="bg-red-100 text-red-800 hover:bg-red-200 font-semibold py-2 px-3 rounded-lg text-sm transition-colors">Clear All Data</button>
                    <button id="printListBtn" type="button" class="bg-blue-100 text-blue-800 hover:bg-blue-200 font-semibold py-2 px-3 rounded-lg text-sm transition-colors desktop-only">Print List</button>
                    <button id="sendToMobileBtn" type="button" class="bg-indigo-100 text-indigo-800 hover:bg-indigo-200 font-semibold py-2 px-3 rounded-lg text-sm transition-colors desktop-only">Send to Mobile for Bedside Review</button>
                </div>
            </div>
            <div id="patientTabsContainer" class="patient-tabs-container flex flex-wrap items-center">
                <div id="tabsPlaceholder" class="w-full p-4 text-center border-2 border-dashed border-gray-200 rounded-md">
                    <p class="text-sm text-gray-400 italic font-light">Patient tabs will appear here as you add them.</p>
                </div>
            </div>
        </div>

        <form id="assessmentForm" onsubmit="return false;">
             <div id="mobileStartScreen" class="mobile-only p-4 rounded-xl shadow-lg bg-white text-center mb-6">
                 <h2 class="text-xl font-bold mb-4">Start Assessment</h2>
                 <p class="text-sm text-gray-600 mb-6">Choose how you would like to start your assessment.</p>
                 <button id="scanQrBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg text-lg transition-colors w-full mb-4">Scan Patient QR Code</button>
                 <button id="startNewBtn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-6 rounded-lg text-lg transition-colors w-full">Start New Patient (Manual Entry)</button>
             </div>

            <div id="mainFormContainer">
                 <div class="bg-white rounded-xl shadow-lg mb-6 overflow-hidden">
                     <div class="header-gradient p-6 flex items-center justify-center text-white">
                         <div class="bg-white/20 rounded-full p-2 mr-4">
                             <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                         </div>
                         <h1 class="text-2xl sm:text-3xl font-bold">ALERT Nursing Risk Assessment Tool</h1>
                     </div>
                 </div>

                 <div class="bg-white rounded-xl shadow-lg mb-6 p-6 space-y-6">
                     <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                         <h3 class="text-lg font-semibold text-gray-700 mb-4">Patient & Review Details</h3>
                         <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4 text-sm">
                             <div class="md:col-span-2">
                                 <label for="reviewType" class="block font-medium text-gray-700">Type of Review:</label>
                                 <select id="reviewType" class="mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                                     <option value="post">Post-ICU stepdown review on ward</option>
                                     <option value="pre">Pre-ICU stepdown review</option>
                                 </select>
                             </div>
                             <div>
                                 <label for="patientInitials" class="block font-medium text-gray-700">Patient Initials:</label>
                                 <input type="text" id="patientInitials" class="mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                             </div>
                             <div>
                                 <label for="wardAndRoom" class="block font-medium text-gray-700">Ward & Room No.:</label>
                                 <input type="text" id="wardAndRoom" class="mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                             </div>
                             <div id="postStepdownFields" class="grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-4">
                                 <div>
                                     <label for="icuStepdownDate" class="block font-medium text-gray-700">ICU Stepdown Date:</label>
                                     <input type="date" id="icuStepdownDate" class="time-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                                 </div>
                                 <div>
                                     <label for="icuStepdownTime" class="block font-medium text-gray-700">ICU Stepdown Time-band:</label>
                                     <select id="icuStepdownTime" class="time-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                                         <option value="09:00" data-ooh="false">Morning (0600-1159)</option>
                                         <option value="15:00" data-ooh="false">Afternoon (1200-1759)</option>
                                         <option value="21:00" data-ooh="true">Evening (1800-2359)</option>
                                         <option value="03:00" data-ooh="true">Night (0000-0559)</option>
                                     </select>
                                 </div>
                             </div>
                             <div>
                                 <label for="losDays" class="block font-medium text-gray-700">ICU LOS (days):</label>
                                 <input type="number" id="losDays" min="0" class="mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                             </div>
                         </div>
                     </div>
                 </div>

                 <div id="qrOverlay" class="qr-overlay hidden">
                     <div class="qr-container">
                         <h2 class="text-2xl font-bold mb-4">Scan with your phone</h2>
                         <p class="text-sm text-gray-600 mb-4">Use your phone's camera to scan this code and open the patient checklist.</p>
                         <div id="qrcode" class="mx-auto w-64 h-64 border border-gray-300 p-2"></div>
                         <button id="closeQrBtn" class="mt-6 bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg">Close</button>
                     </div>
                 </div>

                 <div class="bg-white rounded-xl shadow-lg mb-6 p-6">
                     <div id="scoringContainer">
                         <h2 class="text-xl font-bold text-gray-800 border-b pb-3 mb-4">RISK SCORING ASSESSMENT</h2>
                         <div class="space-y-8">
                             <div class="rounded-lg module-bg-b">
                                 <h3 class="font-bold text-xl mb-3 p-3 rounded-t-lg bg-blue-200 text-blue-800">Physiological & Respiratory Stability</h3>
                                 <div class="space-y-2 p-4">
                                     <label class="flex items-center p-1"><input type="checkbox" class="score-input" data-score="15" data-id="crit_met" data-is-critical="true"> <span class="ml-2">Patient is in MET Criteria</span> <span class="text-gray-600">(+15)</span></label>
                                     <hr class="my-3">
                                     <label class="flex items-center p-1"><input type="checkbox" class="score-input" data-score="10" data-id="crit_adds4" id="crit_adds4_checkbox" data-is-critical="true"> <span class="ml-2">ADDS Score ≥ 4</span> <span class="text-gray-600">(+10)</span></label>
                                     <label class="flex items-center p-1"><input type="radio" name="adds_score" class="score-input" data-score="5" data-id="adds_3" id="adds_3_radio" data-is-amber="true"> <span class="ml-2">ADDS Score 3</span> <span class="text-gray-600">(+5)</span></label>
                                     <label class="flex items-center p-1"><input type="radio" name="adds_score" class="score-input" data-score="1" data-id="adds_0-2" id="adds_0-2_radio" > <span class="ml-2">ADDS Score 0-2</span> <span class="text-gray-600">(+1)</span></label>
                                     <hr class="my-3">
                                     <label class="flex items-center p-1"><input type="checkbox" class="score-input" data-score="5" data-id="adds_worsening" data-is-amber="true"> <span class="ml-2">Worsening ADDS Trend (last 12-24h) (+5)</span></label>
                                     <label class="flex items-center p-1"><input type="checkbox" class="score-input" data-score="10" data-id="resp_increasing_o2" data-is-amber="true"> <span class="ml-2">Increasing O2 requirements in last 12h</span> <span class="text-gray-600">(+10)</span></label>
                                     <label class="flex items-center p-1"><input type="checkbox" class="score-input" data-score="6" data-id="resp_rapid_wean" data-is-amber="true"> <span class="ml-2">Rapid weaning of resp support (e.g. FiO2, NIV, HFNP) in last 4h (+6)</span></label>
                                 </div>
                             </div>
                             <div class="p-4 rounded-lg module-bg-d">
                                 <h3 class="font-bold text-xl mb-3 p-3 rounded-t-lg bg-yellow-200 text-yellow-800">Clinical</h3>
                                 <div class="space-y-2 p-4">
                                     <label class="flex items-center p-1"><input type="radio" name="pain_score" class="score-input" data-score="0" data-id="pain_0" checked> <span class="ml-2 text-gray-500">Pain: None or Well Controlled</span></label>
                                     <label class="flex items-center p-1"><input type="radio" name="pain_score" class="score-input" data-score="3" data-id="pain_iv"> <span class="ml-2">Pain: Requires regular IV or potent analgesia (+3)</span></label>
                                     <label class="flex items-center p-1"><input type="radio" name="pain_score" class="score-input" data-score="5" data-id="pain_pca"> <span class="ml-2">Pain: Poorly controlled or PCA (+5)</span></label>
                                     <hr class="my-2">
                                     <label class="flex items-center p-1"><input type="radio" name="fluid_status_score" class="score-input" data-score="0" data-id="fluid_0" id="fluid_0_radio" checked> <span class="ml-2 text-gray-500">Fluid Status: Euvolaemic</span></label>
                                     <label class="flex items-center p-1"><input type="radio" name="fluid_status_score" class="score-input" data-score="2" data-id="fluid_mild" id="fluid_mild_radio"> <span class="ml-2">Mild dehydration or overload (+2)</span></label>
                                     <label class="flex items-center p-1"><input type="radio" name="fluid_status_score" data-score="4" data-id="fluid_sig" id="fluid_sig_radio" data-is-critical="true"> <span class="ml-2">Significant dehydration or overload (+4)</span></label>
                                     <hr class="my-2">
                                     <label class="flex items-center p-1"><input type="radio" name="diet_score" class="score-input" data-score="0" data-id="diet_0" checked> <span class="ml-2 text-gray-500">Diet: Normal</span></label>
                                     <label class="flex items-center p-1"><input type="radio" name="diet_score" class="score-input" data-score="2" data-id="diet_modified"> <span class="ml-2">Diet: Supplements or Modified (+2)</span></label>
                                     <label class="flex items-center p-1"><input type="radio" name="diet_score" class="score-input" data-score="4" data-id="diet_nbm"> <span class="ml-2">Diet: NBM, NG, or TPN (+4)</span></label>
                                     <hr class="my-2">
                                     <label class="flex items-center p-1"><input type="radio" name="delirium_score" class="score-input" data-score="0" data-id="delirium_0" checked> <span class="ml-2 text-gray-500">Delirium: None</span></label>
                                     <label class="flex items-center p-1"><input type="radio" name="delirium_score" class="score-input" data-score="4" data-id="delirium_mild"> <span class="ml-2">Delirium: Mild or Subsyndromal (+4)</span></label>
                                     <label class="flex items-center p-1"><input type="radio" name="delirium_score" class="score-input" data-score="8" data-id="delirium_mod" data-is-critical="true"> <span class="ml-2">Delirium: Moderate to Severe</span> <span class="text-gray-600">(+8)</span></label>
                                     <hr class="my-2">
                                     <label class="flex items-center p-1"><input type="radio" name="mobility_score" class="score-input" data-score="0" data-id="mobility_0" checked> <span class="ml-2 text-gray-500">Mobility: At Baseline</span></label>
                                     <label class="flex items-center p-1"><input type="radio" name="mobility_score" data-score="1" data-id="mobility_limited"> <span class="ml-2">Mobility: Limited by devices or attachments (+1)</span></label>
                                     <label class="flex items-center p-1"><input type="radio" name="mobility_score" data-score="2" data-id="mobility_assisted"> <span class="ml-2">Mobility: Assisted (+2)</span></label>
                                     <label class="flex items-center p-1"><input type="radio" name="mobility_score" data-score="5" data-id="mobility_bedbound"> <span class="ml-2">Mobility: Bed-bound (+5)</span></label>
                                     <hr class="my-2">
                                     <label class="flex items-center p-1"><input type="radio" name="lines_score" class="score-input" data-score="0" data-id="lines_0" checked> <span class="ml-2 text-gray-500">Lines: None or PIVC only</span></label>
                                     <label class="flex items-center p-1"><input type="radio" name="lines_score" data-score="5" data-id="lines_cvc_present"> <span class="ml-2">Central Line present (CVC/PICC/Vascath) (+5)</span></label>
                                     <hr class="my-3">
                                     <label class="flex items-center p-1"><input type="checkbox" class="score-input" data-score="10" data-id="crit_af" data-is-critical="true"> <span class="ml-2">Unstable Atrial Fibrillation</span> <span class="text-gray-600">(+10)</span></label>
                                     <div class="p-2 border-t mt-2">
                                         <label class="flex items-center p-1"><input type="checkbox" class="score-input" data-score="3" data-id="bowels_issue" id="bowels_issue_checkbox"> <span class="ml-2">Bowels not opened >3 days or Ileus (+3)</span></label>
                                         <div class="grid grid-cols-2 gap-x-4 pl-8 text-sm mt-1">
                                             <div>
                                                 <label for="bowel_last_open" class="block font-medium text-gray-600">Last Bowel Movement:</label>
                                                 <input type="date" id="bowel_last_open" class="bowel-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white p-1 text-sm">
                                             </div>
                                             <div>
                                                 <label for="bowel_type" class="block font-medium text-gray-600">Type:</label>
                                                 <select id="bowel_type" class="bowel-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white p-1 text-sm">
                                                     <option value="">Select...</option>
                                                     <option>Normal</option>
                                                     <option>Diarrhoea</option>
                                                     <option>Constipated</option>
                                                     <option>Ileus / Not passed flatus</option>
                                                     <option>Stoma Active</option>
                                                 </select>
                                             </div>
                                         </div>
                                     </div>
                                     <label class="flex items-center p-1"><input type="checkbox" class="score-input" data-score="5" data-id="airway_altered" data-is-critical="true"> <span class="ml-2">Altered Airway (Tracheostomy/Laryngectomy) (+5)</span></label>
                                     <label class="flex items-center p-1"><input type="checkbox" class="score-input" data-score="3" data-id="drains_high_risk"> <span class="ml-2">High-Risk Drain present <span class="text-gray-400 text-xs">(e.g., chest/subcostal, complex abdo, high output)</span> (+3)</span></label>
                                 </div>
                             </div>
                             <div class="p-4 rounded-lg module-bg-e">
                                 <h3 class="font-bold text-xl mb-3 p-3 rounded-t-lg bg-red-200 text-red-800">Systemic</h3>
                                 <div class="space-y-2 p-4">
                                     <label class="flex items-center p-1"><input type="checkbox" id="losCheckbox" class="score-input" data-score="4" data-id="systemic_los"> <span class="ml-2">ICU LOS > 3 days</span> <span class="text-gray-600">(+4)</span></label>
                                     <hr class="my-3">
                                     <label class="flex items-center p-1"><input type="radio" name="frailty_score" class="score-input" data-score="0" data-id="frailty_0" checked> <span class="ml-2 text-gray-500">Frailty: Not Frail <span class="text-xs italic">(pre-hospital baseline)</span></span></label>
                                     <label class="flex items-center p-1"><input type="radio" name="frailty_score" class="score-input" data-score="2" data-id="frailty_mild"> <span class="ml-2">Frailty: Mild <span class="text-xs italic">(pre-hospital baseline)</span> (+2)</span></label>
                                     <label class="flex items-center p-1"><input type="radio" name="frailty_score" class="score-input" data-score="4" data-id="frailty_mod"> <span class="ml-2">Frailty: Mod-Severe <span class="text-xs italic">(pre-hospital baseline)</span> (+4)</span></label>
                                     <label class="flex items-center p-1"><input type="checkbox" class="score-input" data-score="4" id="comorbiditiesCheckbox" data-id="systemic_comorbid"> <span class="ml-2"><span class="comorbidity-main-text">≥3 chronic comorbidities</span> <span class="text-gray-400 text-xs">(e.g. IHD, COPD, T2DM)</span> (+4)</span></label>
                                     <div id="after_hours_container">
                                         <label class="flex items-center p-1"><input type="checkbox" class="score-input" data-score="0" data-id="systemic_after_hours" id="systemic_after_hours_checkbox" data-is-amber="true"> <span class="ml-2">After-Hours Discharge <span class="text-gray-400 text-xs">(only applies in first 24h)</span></span></label>
                                     </div>
                                 </div>
                             </div>
                             <div id="receivingWardModule" class="p-4 rounded-lg module-bg-g">
                                 <h3 class="font-bold text-xl mb-3 p-3 rounded-t-lg bg-indigo-200 text-indigo-800">Receiving Ward and Staffing</h3>
                                 <div class="space-y-4 p-4">
                                     <div>
                                         <h4 class="block text-sm font-medium text-gray-700 mb-2">Bed Type</h4>
                                         <label class="flex items-center p-1"><input type="radio" name="bed_type" class="score-input" data-score="0" data-id="env_unmonitored" checked> <span class="ml-2">Unmonitored Bed (+0)</span></label>
                                         <label class="flex items-center p-1"><input type="radio" name="bed_type" class="score-input" data-score="-3" data-id="env_monitored"> <span class="ml-2">Monitored / Telemetry Bed (-3)</span></label>
                                     </div>
                                     <hr>
                                     <div>
                                         <h4 class="block text-sm font-medium text-gray-700 mb-2">Staffing</h4>
                                         <label class="flex items-center p-1"><input type="radio" name="env_ratio" class="score-input" data-score="0" data-id="env_standard" checked> <span class="ml-2">Standard Ward Ratio (+0)</span></label>
                                         <label class="flex items-center p-1"><input type="radio" name="env_ratio" class="score-input" data-score="-5" data-id="env_enhanced"> <span class="ml-2">Enhanced Ratio (e.g. 1:1, 1:2) (-5)</span></label>
                                     </div>
                                 </div>
                             </div>
                             <div class="p-4 rounded-lg module-bg-d">
                                 <h3 class="font-bold text-xl mb-3 p-3 rounded-t-lg bg-yellow-200 text-yellow-800">Nursing Concern</h3>
                                 <div class="pt-2 p-4">
                                     <label class="flex items-center p-1"><input type="radio" name="concern_score" class="score-input" data-score="0" data-id="concern_0" value="0" checked> <span class="ml-2 text-gray-500">Nursing Concern: None</span></label>
                                     <label class="flex items-center p-1"><input type="radio" name="concern_score" class="score-input" data-score="5" data-id="concern_present" value="5" data-is-critical="true"> <span class="ml-2">Nursing Concern Present</span> <span class="text-gray-600">(+5)</span></label>
                                     <textarea id="nursingConcernText" class="mt-2 ml-6 w-full rounded-md border-gray-300 shadow-sm text-sm" rows="2" placeholder="Specify concern..." style="display: none;"></textarea>
                                 </div>
                             </div>
                         </div>
                     </div>
                     <div class="final-score-bg text-white rounded-xl shadow-lg p-6 mt-8">
                         <div class="flex flex-col sm:flex-row justify-between items-center text-center">
                             <div class="mb-4 sm:mb-0">
                                 <span class="text-lg font-medium text-gray-400">Preliminary Score</span>
                                 <div id="totalScore" class="text-5xl font-bold">0</div>
                                 <span class="text-xs text-gray-500">(pending patient review)</span>
                             </div>
                             <div class="w-full sm:w-auto">
                                 <span class="text-lg font-medium text-gray-400">Preliminary Category & Action</span>
                                 <div id="riskCategory" class="text-xl font-bold p-3 rounded-md mt-1 transition-all duration-300"></div>
                             </div>
                         </div>
                     </div>
                 </div>

                 <div class="bg-white rounded-xl shadow-lg mb-6 p-6 space-y-6">
                     <h2 class="text-2xl font-bold text-gray-800 border-b pb-3 mb-6">ALERT Nurse Assessment</h2>
                     <div class="mb-6 bg-gray-50 p-4 rounded-lg border border-gray-200">
                         <h3 class="font-semibold text-gray-700 mb-2">ADDS</h3>
                         <p class="text-xs italic text-gray-500 mb-4">Entering observations here will calculate a new ADDS and update the final score.</p>
                         <div class="space-y-4">
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">Airway</label>
                                 <div class="sm:col-span-2">
                                     <select id="airway_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                                         <option>Patent</option>
                                         <option>At Risk</option>
                                         <option>Tracheostomy</option>
                                         <option>Laryngectomy</option>
                                     </select>
                                 </div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">Resp Rate</label>
                                 <div class="sm:col-span-2"><input type="number" id="rr_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">SpO2 (%)</label>
                                 <div class="sm:col-span-2"><input type="number" id="spo2_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">Oxygen Delivery</label>
                                 <div class="sm:col-span-2 flex items-center space-x-2">
                                     <input type="number" id="o2_flow_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm" placeholder="Value">
                                     <select id="o2_unit_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"><option value="lpm">L/min</option><option value="fio2">% FiO2</option></select>
                                 </div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">Heart Rate</label>
                                 <div class="sm:col-span-2"><input type="number" id="hr_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">SBP (mmHg)</label>
                                 <div class="sm:col-span-2"><input type="number" id="sbp_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">DBP (mmHg)</label>
                                 <div class="sm:col-span-2"><input type="number" id="dbp_input" class="mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">Consciousness</label>
                                 <div class="sm:col-span-2"><select id="consciousness_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"><option value="0">Alert</option><option value="1">Voice</option><option value="2">Pain</option><option value="3">Unresponsive</option></select></div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">Temp (°C)</label>
                                 <div class="sm:col-span-2"><input type="number" step="0.1" id="temp_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></div>
                             </div>
                         </div>
                         <div class="mt-6 bg-gray-100 p-4 rounded-lg border border-gray-300">
                             <label class="flex items-center"><input type="checkbox" id="addsModificationCheckbox" class="vital-input"> <span class="ml-2 text-sm font-medium text-gray-800">Apply MODS to ADDS</span></label>
                             <div id="addsModificationDetails" class="hidden ml-6 mt-4 space-y-4">
                                 <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6 text-sm">
                                     <div class="space-y-1">
                                         <label class="flex items-center"><input type="checkbox" name="mod_param" value="RR"> <span class="ml-2 font-medium">Resp Rate</span></label>
                                         <div class="hidden mod-details space-y-2 pl-5 pt-2">
                                             <select data-param="rr" class="mod-operator mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"><option value="less_than">Less than</option><option value="greater_than">Greater than</option><option value="between">Between</option></select>
                                             <div class="flex items-center space-x-2">
                                                 <input type="number" data-param="rr_val1" placeholder="Value" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                                                 <span class="mod-val2-container" style="display:none;"><input type="number" data-param="rr_val2" placeholder="Max" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></span>
                                             </div>
                                         </div>
                                     </div>
                                     <div class="space-y-1">
                                         <label class="flex items-center"><input type="checkbox" name="mod_param" value="HR"> <span class="ml-2 font-medium">Heart Rate</span></label>
                                         <div class="hidden mod-details space-y-2 pl-5 pt-2">
                                             <select data-param="hr" class="mod-operator mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"><option value="less_than">Less than</option><option value="greater_than">Greater than</option><option value="between">Between</option></select>
                                             <div class="flex items-center space-x-2">
                                                 <input type="number" data-param="hr_val1" placeholder="Value" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                                                 <span class="mod-val2-container" style="display:none;"><input type="number" data-param="hr_val2" placeholder="Max" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></span>
                                             </div>
                                         </div>
                                     </div>
                                     <div class="space-y-1">
                                         <label class="flex items-center"><input type="checkbox" name="mod_param" value="SpO2"> <span class="ml-2 font-medium">SpO2</span></label>
                                         <div class="hidden mod-details flex items-center space-x-2 pl-5 pt-2">
                                             <span class="font-semibold">Target ></span>
                                             <input type="number" data-param="spo2_lower" placeholder="e.g. 88" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                                             <span>%</span>
                                         </div>
                                     </div>
                                     <div class="space-y-1">
                                         <label class="flex items-center"><input type="checkbox" name="mod_param" value="SBP"> <span class="ml-2 font-medium">SBP</span></label>
                                         <div class="hidden mod-details flex items-center space-x-2 pl-5 pt-2">
                                             <span class="font-semibold">Target ></span>
                                             <input type="number" data-param="sbp_lower" placeholder="e.g. 90" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                                         </div>
                                     </div>
                                     <div class="space-y-1 md:col-span-2">
                                         <label class="flex items-center"><input type="checkbox" name="mod_param" value="Consciousness"> <span class="ml-2 font-medium">Consciousness</span></label>
                                         <div class="hidden mod-details space-y-2 pl-5 pt-2">
                                             <label class="block text-xs font-medium text-gray-600">Consider 'Normal' if at or better than:</label>
                                             <select data-param="consciousness_baseline" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                                                 <option value="0">Alert</option>
                                                 <option value="1">Voice</option>
                                                 <option value="2">Pain</option>
                                                 <option value="3">Unresponsive</option>
                                             </select>
                                             <label class="block text-xs font-medium text-gray-600 mt-2">Notes (e.g., GCS target):</label>
                                             <input type="text" data-param="consciousness_notes" placeholder="e.g. GCS E4V5M6" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                                         </div>
                                     </div>
                                 </div>
                                 <div class="pt-4">
                                     <label for="addsModificationText" class="block text-sm font-medium text-gray-700">Modification Rationale:</label>
                                     <textarea id="addsModificationText" rows="2" class="mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></textarea>
                                 </div>
                             </div>
                         </div>
                         <div class="mt-6 bg-teal-50 p-4 rounded-lg text-center border border-teal-200">
                             <span class="text-sm font-medium text-gray-500">CALCULATED ADDS</span>
                             <div id="calculatedADDSScore" class="font-bold text-5xl text-teal-600 my-2">0</div>
                             <div id="addsBreakdown" class="text-xs text-gray-600 min-h-[3em]">Normal Parameters</div>
                         </div>
                     </div>
                 </div>

                 <div class="bg-white rounded-xl shadow-lg mb-6 p-6 space-y-6">
                     <h2 class="text-2xl font-bold text-gray-800 border-b pb-3 mb-6">ALERT Nurse Assessment</h2>
                     <div class="mb-6 bg-gray-50 p-4 rounded-lg border border-gray-200">
                         <h3 class="font-semibold text-gray-700 mb-2">ADDS</h3>
                         <p class="text-xs italic text-gray-500 mb-4">Entering observations here will calculate a new ADDS and update the final score.</p>
                         <div class="space-y-4">
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">Airway</label>
                                 <div class="sm:col-span-2">
                                     <select id="airway_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                                         <option>Patent</option>
                                         <option>At Risk</option>
                                         <option>Tracheostomy</option>
                                         <option>Laryngectomy</option>
                                     </select>
                                 </div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">Resp Rate</label>
                                 <div class="sm:col-span-2"><input type="number" id="rr_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">SpO2 (%)</label>
                                 <div class="sm:col-span-2"><input type="number" id="spo2_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">Oxygen Delivery</label>
                                 <div class="sm:col-span-2 flex items-center space-x-2">
                                     <input type="number" id="o2_flow_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm" placeholder="Value">
                                     <select id="o2_unit_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"><option value="lpm">L/min</option><option value="fio2">% FiO2</option></select>
                                 </div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">Heart Rate</label>
                                 <div class="sm:col-span-2"><input type="number" id="hr_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">SBP (mmHg)</label>
                                 <div class="sm:col-span-2"><input type="number" id="sbp_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">DBP (mmHg)</label>
                                 <div class="sm:col-span-2"><input type="number" id="dbp_input" class="mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">Consciousness</label>
                                 <div class="sm:col-span-2"><select id="consciousness_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"><option value="0">Alert</option><option value="1">Voice</option><option value="2">Pain</option><option value="3">Unresponsive</option></select></div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">Temp (°C)</label>
                                 <div class="sm:col-span-2"><input type="number" step="0.1" id="temp_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></div>
                             </div>
                         </div>
                         <div class="mt-6 bg-gray-100 p-4 rounded-lg border border-gray-300">
                             <label class="flex items-center"><input type="checkbox" id="addsModificationCheckbox" class="vital-input"> <span class="ml-2 text-sm font-medium text-gray-800">Apply MODS to ADDS</span></label>
                             <div id="addsModificationDetails" class="hidden ml-6 mt-4 space-y-4">
                                 <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6 text-sm">
                                     <div class="space-y-1">
                                         <label class="flex items-center"><input type="checkbox" name="mod_param" value="RR"> <span class="ml-2 font-medium">Resp Rate</span></label>
                                         <div class="hidden mod-details space-y-2 pl-5 pt-2">
                                             <select data-param="rr" class="mod-operator mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"><option value="less_than">Less than</option><option value="greater_than">Greater than</option><option value="between">Between</option></select>
                                             <div class="flex items-center space-x-2">
                                                 <input type="number" data-param="rr_val1" placeholder="Value" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                                                 <span class="mod-val2-container" style="display:none;"><input type="number" data-param="rr_val2" placeholder="Max" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></span>
                                             </div>
                                         </div>
                                     </div>
                                     <div class="space-y-1">
                                         <label class="flex items-center"><input type="checkbox" name="mod_param" value="HR"> <span class="ml-2 font-medium">Heart Rate</span></label>
                                         <div class="hidden mod-details space-y-2 pl-5 pt-2">
                                             <select data-param="hr" class="mod-operator mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"><option value="less_than">Less than</option><option value="greater_than">Greater than</option><option value="between">Between</option></select>
                                             <div class="flex items-center space-x-2">
                                                 <input type="number" data-param="hr_val1" placeholder="Value" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                                                 <span class="mod-val2-container" style="display:none;"><input type="number" data-param="hr_val2" placeholder="Max" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></span>
                                             </div>
                                         </div>
                                     </div>
                                     <div class="space-y-1">
                                         <label class="flex items-center"><input type="checkbox" name="mod_param" value="SpO2"> <span class="ml-2 font-medium">SpO2</span></label>
                                         <div class="hidden mod-details flex items-center space-x-2 pl-5 pt-2">
                                             <span class="font-semibold">Target ></span>
                                             <input type="number" data-param="spo2_lower" placeholder="e.g. 88" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                                             <span>%</span>
                                         </div>
                                     </div>
                                     <div class="space-y-1">
                                         <label class="flex items-center"><input type="checkbox" name="mod_param" value="SBP"> <span class="ml-2 font-medium">SBP</span></label>
                                         <div class="hidden mod-details flex items-center space-x-2 pl-5 pt-2">
                                             <span class="font-semibold">Target ></span>
                                             <input type="number" data-param="sbp_lower" placeholder="e.g. 90" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                                         </div>
                                     </div>
                                     <div class="space-y-1 md:col-span-2">
                                         <label class="flex items-center"><input type="checkbox" name="mod_param" value="Consciousness"> <span class="ml-2 font-medium">Consciousness</span></label>
                                         <div class="hidden mod-details space-y-2 pl-5 pt-2">
                                             <label class="block text-xs font-medium text-gray-600">Consider 'Normal' if at or better than:</label>
                                             <select data-param="consciousness_baseline" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                                                 <option value="0">Alert</option>
                                                 <option value="1">Voice</option>
                                                 <option value="2">Pain</option>
                                                 <option value="3">Unresponsive</option>
                                             </select>
                                             <label class="block text-xs font-medium text-gray-600 mt-2">Notes (e.g., GCS target):</label>
                                             <input type="text" data-param="consciousness_notes" placeholder="e.g. GCS E4V5M6" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                                         </div>
                                     </div>
                                 </div>
                                 <div class="pt-4">
                                     <label for="addsModificationText" class="block text-sm font-medium text-gray-700">Modification Rationale:</label>
                                     <textarea id="addsModificationText" rows="2" class="mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></textarea>
                                 </div>
                             </div>
                         </div>
                         <div class="mt-6 bg-teal-50 p-4 rounded-lg text-center border border-teal-200">
                             <span class="text-sm font-medium text-gray-500">CALCULATED ADDS</span>
                             <div id="calculatedADDSScore" class="font-bold text-5xl text-teal-600 my-2">0</div>
                             <div id="addsBreakdown" class="text-xs text-gray-600 min-h-[3em]">Normal Parameters</div>
                         </div>
                     </div>
                 </div>

                 <div class="bg-white rounded-xl shadow-lg mb-6 p-6 space-y-6">
                     <h2 class="text-2xl font-bold text-gray-800 border-b pb-3 mb-6">ALERT Nurse Assessment</h2>
                     <div class="mb-6 bg-gray-50 p-4 rounded-lg border border-gray-200">
                         <h3 class="font-semibold text-gray-700 mb-2">ADDS</h3>
                         <p class="text-xs italic text-gray-500 mb-4">Entering observations here will calculate a new ADDS and update the final score.</p>
                         <div class="space-y-4">
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">Airway</label>
                                 <div class="sm:col-span-2">
                                     <select id="airway_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                                         <option>Patent</option>
                                         <option>At Risk</option>
                                         <option>Tracheostomy</option>
                                         <option>Laryngectomy</option>
                                     </select>
                                 </div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">Resp Rate</label>
                                 <div class="sm:col-span-2"><input type="number" id="rr_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">SpO2 (%)</label>
                                 <div class="sm:col-span-2"><input type="number" id="spo2_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">Oxygen Delivery</label>
                                 <div class="sm:col-span-2 flex items-center space-x-2">
                                     <input type="number" id="o2_flow_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm" placeholder="Value">
                                     <select id="o2_unit_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"><option value="lpm">L/min</option><option value="fio2">% FiO2</option></select>
                                 </div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">Heart Rate</label>
                                 <div class="sm:col-span-2"><input type="number" id="hr_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">SBP (mmHg)</label>
                                 <div class="sm:col-span-2"><input type="number" id="sbp_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">DBP (mmHg)</label>
                                 <div class="sm:col-span-2"><input type="number" id="dbp_input" class="mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">Consciousness</label>
                                 <div class="sm:col-span-2"><select id="consciousness_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"><option value="0">Alert</option><option value="1">Voice</option><option value="2">Pain</option><option value="3">Unresponsive</option></select></div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">Temp (°C)</label>
                                 <div class="sm:col-span-2"><input type="number" step="0.1" id="temp_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></div>
                             </div>
                         </div>
                         <div class="mt-6 bg-gray-100 p-4 rounded-lg border border-gray-300">
                             <label class="flex items-center"><input type="checkbox" id="addsModificationCheckbox" class="vital-input"> <span class="ml-2 text-sm font-medium text-gray-800">Apply MODS to ADDS</span></label>
                             <div id="addsModificationDetails" class="hidden ml-6 mt-4 space-y-4">
                                 <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6 text-sm">
                                     <div class="space-y-1">
                                         <label class="flex items-center"><input type="checkbox" name="mod_param" value="RR"> <span class="ml-2 font-medium">Resp Rate</span></label>
                                         <div class="hidden mod-details space-y-2 pl-5 pt-2">
                                             <select data-param="rr" class="mod-operator mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"><option value="less_than">Less than</option><option value="greater_than">Greater than</option><option value="between">Between</option></select>
                                             <div class="flex items-center space-x-2">
                                                 <input type="number" data-param="rr_val1" placeholder="Value" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                                                 <span class="mod-val2-container" style="display:none;"><input type="number" data-param="rr_val2" placeholder="Max" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></span>
                                             </div>
                                         </div>
                                     </div>
                                     <div class="space-y-1">
                                         <label class="flex items-center"><input type="checkbox" name="mod_param" value="HR"> <span class="ml-2 font-medium">Heart Rate</span></label>
                                         <div class="hidden mod-details space-y-2 pl-5 pt-2">
                                             <select data-param="hr" class="mod-operator mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"><option value="less_than">Less than</option><option value="greater_than">Greater than</option><option value="between">Between</option></select>
                                             <div class="flex items-center space-x-2">
                                                 <input type="number" data-param="hr_val1" placeholder="Value" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                                                 <span class="mod-val2-container" style="display:none;"><input type="number" data-param="hr_val2" placeholder="Max" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></span>
                                             </div>
                                         </div>
                                     </div>
                                     <div class="space-y-1">
                                         <label class="flex items-center"><input type="checkbox" name="mod_param" value="SpO2"> <span class="ml-2 font-medium">SpO2</span></label>
                                         <div class="hidden mod-details flex items-center space-x-2 pl-5 pt-2">
                                             <span class="font-semibold">Target ></span>
                                             <input type="number" data-param="spo2_lower" placeholder="e.g. 88" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                                             <span>%</span>
                                         </div>
                                     </div>
                                     <div class="space-y-1">
                                         <label class="flex items-center"><input type="checkbox" name="mod_param" value="SBP"> <span class="ml-2 font-medium">SBP</span></label>
                                         <div class="hidden mod-details flex items-center space-x-2 pl-5 pt-2">
                                             <span class="font-semibold">Target ></span>
                                             <input type="number" data-param="sbp_lower" placeholder="e.g. 90" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                                         </div>
                                     </div>
                                     <div class="space-y-1 md:col-span-2">
                                         <label class="flex items-center"><input type="checkbox" name="mod_param" value="Consciousness"> <span class="ml-2 font-medium">Consciousness</span></label>
                                         <div class="hidden mod-details space-y-2 pl-5 pt-2">
                                             <label class="block text-xs font-medium text-gray-600">Consider 'Normal' if at or better than:</label>
                                             <select data-param="consciousness_baseline" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                                                 <option value="0">Alert</option>
                                                 <option value="1">Voice</option>
                                                 <option value="2">Pain</option>
                                                 <option value="3">Unresponsive</option>
                                             </select>
                                             <label class="block text-xs font-medium text-gray-600 mt-2">Notes (e.g., GCS target):</label>
                                             <input type="text" data-param="consciousness_notes" placeholder="e.g. GCS E4V5M6" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                                         </div>
                                     </div>
                                 </div>
                                 <div class="pt-4">
                                     <label for="addsModificationText" class="block text-sm font-medium text-gray-700">Modification Rationale:</label>
                                     <textarea id="addsModificationText" rows="2" class="mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></textarea>
                                 </div>
                             </div>
                         </div>
                         <div class="mt-6 bg-teal-50 p-4 rounded-lg text-center border border-teal-200">
                             <span class="text-sm font-medium text-gray-500">CALCULATED ADDS</span>
                             <div id="calculatedADDSScore" class="font-bold text-5xl text-teal-600 my-2">0</div>
                             <div id="addsBreakdown" class="text-xs text-gray-600 min-h-[3em]">Normal Parameters</div>
                         </div>
                     </div>
                 </div>

                 <div class="bg-white rounded-xl shadow-lg mb-6 p-6 space-y-6">
                     <h2 class="text-2xl font-bold text-gray-800 border-b pb-3 mb-6">ALERT Nurse Assessment</h2>
                     <div class="mb-6 bg-gray-50 p-4 rounded-lg border border-gray-200">
                         <h3 class="font-semibold text-gray-700 mb-2">ADDS</h3>
                         <p class="text-xs italic text-gray-500 mb-4">Entering observations here will calculate a new ADDS and update the final score.</p>
                         <div class="space-y-4">
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">Airway</label>
                                 <div class="sm:col-span-2">
                                     <select id="airway_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                                         <option>Patent</option>
                                         <option>At Risk</option>
                                         <option>Tracheostomy</option>
                                         <option>Laryngectomy</option>
                                     </select>
                                 </div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">Resp Rate</label>
                                 <div class="sm:col-span-2"><input type="number" id="rr_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">SpO2 (%)</label>
                                 <div class="sm:col-span-2"><input type="number" id="spo2_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">Oxygen Delivery</label>
                                 <div class="sm:col-span-2 flex items-center space-x-2">
                                     <input type="number" id="o2_flow_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm" placeholder="Value">
                                     <select id="o2_unit_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"><option value="lpm">L/min</option><option value="fio2">% FiO2</option></select>
                                 </div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">Heart Rate</label>
                                 <div class="sm:col-span-2"><input type="number" id="hr_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">SBP (mmHg)</label>
                                 <div class="sm:col-span-2"><input type="number" id="sbp_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">DBP (mmHg)</label>
                                 <div class="sm:col-span-2"><input type="number" id="dbp_input" class="mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">Consciousness</label>
                                 <div class="sm:col-span-2"><select id="consciousness_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"><option value="0">Alert</option><option value="1">Voice</option><option value="2">Pain</option><option value="3">Unresponsive</option></select></div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">Temp (°C)</label>
                                 <div class="sm:col-span-2"><input type="number" step="0.1" id="temp_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></div>
                             </div>
                         </div>
                         <div class="mt-6 bg-gray-100 p-4 rounded-lg border border-gray-300">
                             <label class="flex items-center"><input type="checkbox" id="addsModificationCheckbox" class="vital-input"> <span class="ml-2 text-sm font-medium text-gray-800">Apply MODS to ADDS</span></label>
                             <div id="addsModificationDetails" class="hidden ml-6 mt-4 space-y-4">
                                 <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6 text-sm">
                                     <div class="space-y-1">
                                         <label class="flex items-center"><input type="checkbox" name="mod_param" value="RR"> <span class="ml-2 font-medium">Resp Rate</span></label>
                                         <div class="hidden mod-details space-y-2 pl-5 pt-2">
                                             <select data-param="rr" class="mod-operator mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"><option value="less_than">Less than</option><option value="greater_than">Greater than</option><option value="between">Between</option></select>
                                             <div class="flex items-center space-x-2">
                                                 <input type="number" data-param="rr_val1" placeholder="Value" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                                                 <span class="mod-val2-container" style="display:none;"><input type="number" data-param="rr_val2" placeholder="Max" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></span>
                                             </div>
                                         </div>
                                     </div>
                                     <div class="space-y-1">
                                         <label class="flex items-center"><input type="checkbox" name="mod_param" value="HR"> <span class="ml-2 font-medium">Heart Rate</span></label>
                                         <div class="hidden mod-details space-y-2 pl-5 pt-2">
                                             <select data-param="hr" class="mod-operator mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"><option value="less_than">Less than</option><option value="greater_than">Greater than</option><option value="between">Between</option></select>
                                             <div class="flex items-center space-x-2">
                                                 <input type="number" data-param="hr_val1" placeholder="Value" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                                                 <span class="mod-val2-container" style="display:none;"><input type="number" data-param="hr_val2" placeholder="Max" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></span>
                                             </div>
                                         </div>
                                     </div>
                                     <div class="space-y-1">
                                         <label class="flex items-center"><input type="checkbox" name="mod_param" value="SpO2"> <span class="ml-2 font-medium">SpO2</span></label>
                                         <div class="hidden mod-details flex items-center space-x-2 pl-5 pt-2">
                                             <span class="font-semibold">Target ></span>
                                             <input type="number" data-param="spo2_lower" placeholder="e.g. 88" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                                             <span>%</span>
                                         </div>
                                     </div>
                                     <div class="space-y-1">
                                         <label class="flex items-center"><input type="checkbox" name="mod_param" value="SBP"> <span class="ml-2 font-medium">SBP</span></label>
                                         <div class="hidden mod-details flex items-center space-x-2 pl-5 pt-2">
                                             <span class="font-semibold">Target ></span>
                                             <input type="number" data-param="sbp_lower" placeholder="e.g. 90" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                                         </div>
                                     </div>
                                     <div class="space-y-1 md:col-span-2">
                                         <label class="flex items-center"><input type="checkbox" name="mod_param" value="Consciousness"> <span class="ml-2 font-medium">Consciousness</span></label>
                                         <div class="hidden mod-details space-y-2 pl-5 pt-2">
                                             <label class="block text-xs font-medium text-gray-600">Consider 'Normal' if at or better than:</label>
                                             <select data-param="consciousness_baseline" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                                                 <option value="0">Alert</option>
                                                 <option value="1">Voice</option>
                                                 <option value="2">Pain</option>
                                                 <option value="3">Unresponsive</option>
                                             </select>
                                             <label class="block text-xs font-medium text-gray-600 mt-2">Notes (e.g., GCS target):</label>
                                             <input type="text" data-param="consciousness_notes" placeholder="e.g. GCS E4V5M6" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                                         </div>
                                     </div>
                                 </div>
                                 <div class="pt-4">
                                     <label for="addsModificationText" class="block text-sm font-medium text-gray-700">Modification Rationale:</label>
                                     <textarea id="addsModificationText" rows="2" class="mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></textarea>
                                 </div>
                             </div>
                         </div>
                         <div class="mt-6 bg-teal-50 p-4 rounded-lg text-center border border-teal-200">
                             <span class="text-sm font-medium text-gray-500">CALCULATED ADDS</span>
                             <div id="calculatedADDSScore" class="font-bold text-5xl text-teal-600 my-2">0</div>
                             <div id="addsBreakdown" class="text-xs text-gray-600 min-h-[3em]">Normal Parameters</div>
                         </div>
                     </div>
                 </div>

                 <div class="bg-white rounded-xl shadow-lg mb-6 p-6 space-y-6">
                     <h2 class="text-2xl font-bold text-gray-800 border-b pb-3 mb-6">ALERT Nurse Assessment</h2>
                     <div class="mb-6 bg-gray-50 p-4 rounded-lg border border-gray-200">
                         <h3 class="font-semibold text-gray-700 mb-2">ADDS</h3>
                         <p class="text-xs italic text-gray-500 mb-4">Entering observations here will calculate a new ADDS and update the final score.</p>
                         <div class="space-y-4">
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">Airway</label>
                                 <div class="sm:col-span-2">
                                     <select id="airway_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                                         <option>Patent</option>
                                         <option>At Risk</option>
                                         <option>Tracheostomy</option>
                                         <option>Laryngectomy</option>
                                     </select>
                                 </div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">Resp Rate</label>
                                 <div class="sm:col-span-2"><input type="number" id="rr_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">SpO2 (%)</label>
                                 <div class="sm:col-span-2"><input type="number" id="spo2_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">Oxygen Delivery</label>
                                 <div class="sm:col-span-2 flex items-center space-x-2">
                                     <input type="number" id="o2_flow_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm" placeholder="Value">
                                     <select id="o2_unit_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"><option value="lpm">L/min</option><option value="fio2">% FiO2</option></select>
                                 </div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">Heart Rate</label>
                                 <div class="sm:col-span-2"><input type="number" id="hr_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">SBP (mmHg)</label>
                                 <div class="sm:col-span-2"><input type="number" id="sbp_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">DBP (mmHg)</label>
                                 <div class="sm:col-span-2"><input type="number" id="dbp_input" class="mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">Consciousness</label>
                                 <div class="sm:col-span-2"><select id="consciousness_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"><option value="0">Alert</option><option value="1">Voice</option><option value="2">Pain</option><option value="3">Unresponsive</option></select></div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-3 gap-x-4 items-center">
                                 <label class="block text-sm font-medium text-gray-700 sm:col-span-1">Temp (°C)</label>
                                 <div class="sm:col-span-2"><input type="number" step="0.1" id="temp_input" class="vital-input mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></div>
                             </div>
                         </div>
                         <div class="mt-6 bg-gray-100 p-4 rounded-lg border border-gray-300">
                             <label class="flex items-center"><input type="checkbox" id="addsModificationCheckbox" class="vital-input"> <span class="ml-2 text-sm font-medium text-gray-800">Apply MODS to ADDS</span></label>
                             <div id="addsModificationDetails" class="hidden ml-6 mt-4 space-y-4">
                                 <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6 text-sm">
                                     <div class="space-y-1">
                                         <label class="flex items-center"><input type="checkbox" name="mod_param" value="RR"> <span class="ml-2 font-medium">Resp Rate</span></label>
                                         <div class="hidden mod-details space-y-2 pl-5 pt-2">
                                             <select data-param="rr" class="mod-operator mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"><option value="less_than">Less than</option><option value="greater_than">Greater than</option><option value="between">Between</option></select>
                                             <div class="flex items-center space-x-2">
                                                 <input type="number" data-param="rr_val1" placeholder="Value" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                                                 <span class="mod-val2-container" style="display:none;"><input type="number" data-param="rr_val2" placeholder="Max" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></span>
                                             </div>
                                         </div>
                                     </div>
                                     <div class="space-y-1">
                                         <label class="flex items-center"><input type="checkbox" name="mod_param" value="HR"> <span class="ml-2 font-medium">Heart Rate</span></label>
                                         <div class="hidden mod-details space-y-2 pl-5 pt-2">
                                             <select data-param="hr" class="mod-operator mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"><option value="less_than">Less than</option><option value="greater_than">Greater than</option><option value="between">Between</option></select>
                                             <div class="flex items-center space-x-2">
                                                 <input type="number" data-param="hr_val1" placeholder="Value" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                                                 <span class="mod-val2-container" style="display:none;"><input type="number" data-param="hr_val2" placeholder="Max" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></span>
                                             </div>
                                         </div>
                                     </div>
                                     <div class="space-y-1">
                                         <label class="flex items-center"><input type="checkbox" name="mod_param" value="SpO2"> <span class="ml-2 font-medium">SpO2</span></label>
                                         <div class="hidden mod-details flex items-center space-x-2 pl-5 pt-2">
                                             <span class="font-semibold">Target ></span>
                                             <input type="number" data-param="spo2_lower" placeholder="e.g. 88" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                                             <span>%</span>
                                         </div>
                                     </div>
                                     <div class="space-y-1">
                                         <label class="flex items-center"><input type="checkbox" name="mod_param" value="SBP"> <span class="ml-2 font-medium">SBP</span></label>
                                         <div class="hidden mod-details flex items-center space-x-2 pl-5 pt-2">
                                             <span class="font-semibold">Target ></span>
                                             <input type="number" data-param="sbp_lower" placeholder="e.g. 90" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                                         </div>
                                     </div>
                                     <div class="space-y-1 md:col-span-2">
                                         <label class="flex items-center"><input type="checkbox" name="mod_param" value="Consciousness"> <span class="ml-2 font-medium">Consciousness</span></label>
                                         <div class="hidden mod-details space-y-2 pl-5 pt-2">
                                             <label class="block text-xs font-medium text-gray-600">Consider 'Normal' if at or better than:</label>
                                             <select data-param="consciousness_baseline" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                                                 <option value="0">Alert</option>
                                                 <option value="1">Voice</option>
                                                 <option value="2">Pain</option>
                                                 <option value="3">Unresponsive</option>
                                             </select>
                                             <label class="block text-xs font-medium text-gray-600 mt-2">Notes (e.g., GCS target):</label>
                                             <input type="text" data-param="consciousness_notes" placeholder="e.g. GCS E4V5M6" class="mod-value mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm">
                                         </div>
                                     </div>
                                 </div>
                                 <div class="pt-4">
                                     <label for="addsModificationText" class="block text-sm font-medium text-gray-700">Modification Rationale:</label>
                                     <textarea id="addsModificationText" rows="2" class="mt-1 block w-full rounded-md border-2 border-gray-300 bg-white shadow-sm p-2 text-sm"></textarea>
                                 </div>
                             </div>
                         </div>
                         <div class="mt-6 bg-teal-50 p-4 rounded-lg text-center border border-teal-200">
                             <span class="text-sm font-medium text-gray-500">CALCULATED ADDS</span>
                             <div id="calculatedADDSScore" class="font-bold text-5xl text-teal-600 my-2">0</div>
                             <div id="addsBreakdown" class="text-xs text-gray-600 min-h-[3em]">Normal Parameters</div>
                         </div>
                     </div>
                 </div>

                 <div class="bg-white rounded-xl shadow-lg mt-6 p-6">
                     <div class="final-score-bg text-white rounded-xl shadow-lg p-6 mb-6">
                         <div class="flex flex-col sm:flex-row justify-between items-center text-center">
                             <div class="mb-4 sm:mb-0">
                                 <span class="text-lg font-medium text-gray-400">Updated Final Score</span>
                                 <div id="updatedTotalScore" class="text-5xl font-bold">0</div>
                             </div>
                             <div class="w-full sm:w-auto">
                                 <span class="text-lg font-medium text-gray-400">FINAL CATEGORY & ACTION</span>
                                 <div id="updatedRiskCategory" class="text-xl font-bold p-3 rounded-md mt-1 transition-all duration-300"></div>
                             </div>
                         </div>
                     </div>
                     <h2 class="text-xl font-bold text-gray-800 border-b pb-3 mb-4">DMR Summary Generator</h2>
                     <div class="flex space-x-4 mb-4">
                         <button type="button" id="generateSummaryButton" class="bg-teal-600 hover:bg-teal-700 text-white font-bold py-2 px-4 rounded-lg transition-colors w-1/2">Generate DMR Summary</button>
                         <button type="button" id="copySummaryButton" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition-colors w-1/2">Copy to Clipboard</button>
                     </div>
                     <textarea id="emrSummary" rows="20" class="w-full p-2 border border-gray-300 rounded-md bg-gray-50 font-mono text-xs" placeholder="Your summary will appear here..."></textarea>
                     <div class="mt-6 text-center">
                         <button type="button" id="resetButton" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">Reset Form</button>
                     </div>
                 </div>
            </div>
        </form>
    </div>

    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <script>
        const categoryColorMap = {
            'risk-critical': '#DC2626', 'risk-intensive-escalate': '#F97316', 'risk-intensive': '#F59E0B',
            'risk-standard': '#2DD4BF', 'risk-single': '#67E8F9'
        };

        document.addEventListener('DOMContentLoaded', () => {
            const assessmentForm = document.getElementById('assessmentForm');
            const patientTabsContainer = document.getElementById('patientTabsContainer');
            const tabsPlaceholder = document.getElementById('tabsPlaceholder');
            const mainFormContainer = document.getElementById('mainFormContainer');
            const mobileStartScreen = document.getElementById('mobileStartScreen');
            const qrOverlay = document.getElementById('qrOverlay');
            const qrcodeContainer = document.getElementById('qrcode');
            const sendToMobileBtn = document.getElementById('sendToMobileBtn');
            const addPatientBtn = document.getElementById('addPatientBtn');
            const clearDataBtn = document.getElementById('clearDataBtn');
            const startNewBtn = document.getElementById('startNewBtn');
            const scanQrBtn = document.getElementById('scanQrBtn');
            const closeQrBtn = document.getElementById('closeQrBtn');
            const generateSummaryButton = document.getElementById('generateSummaryButton');
            const copySummaryButton = document.getElementById('copySummaryButton');
            const emrSummaryEl = document.getElementById('emrSummary');

            let patients = {};
            let activePatientId = null;
            const LOCAL_STORAGE_KEY = 'alertToolPatientData_v6.0';
            const QR_BASE_URL = window.location.href.split('?')[0];
            const isMobile = window.innerWidth <= 768;

            function saveState() {
                localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify({ patients, activePatientId }));
            }

            function loadAllData() {
                const savedData = localStorage.getItem(LOCAL_STORAGE_KEY);
                if (savedData) {
                    try {
                        const parsedData = JSON.parse(savedData);
                        patients = parsedData.patients || {};
                        activePatientId = parsedData.activePatientId;
                    } catch (e) { console.error("Failed to parse data", e); patients = {}; activePatientId = null; }
                }

                const urlParams = new URLSearchParams(window.location.search);
                const qrData = urlParams.get('data');
                if (qrData) {
                    try {
                        const decodedData = JSON.parse(atob(qrData));
                        if (decodedData && Array.isArray(decodedData)) {
                            patients = {};
                            decodedData.forEach(p => patients[p.id] = p);
                            if (decodedData.length > 0) {
                                activePatientId = decodedData[0].id;
                                saveState();
                                window.history.replaceState({}, document.title, QR_BASE_URL);
                                loadAllData();
                            }
                        }
                    } catch (e) { console.error("Failed to decode QR data", e); }
                }

                if (Object.keys(patients).length === 0) {
                    addPatient(false);
                }
                
                if (!activePatientId || !patients[activePatientId]) { activePatientId = Object.keys(patients)[0]; }
                switchPatient(activePatientId);
                renderTabs();
            }

            function getFormData() {
                const data = {};
                assessmentForm.querySelectorAll('input, select, textarea').forEach(el => {
                    let id = el.id;
                    if(el.dataset.param) id = el.dataset.param;
                    else if (!id) id = el.name;
                    if (id) data[id] = el.type === 'checkbox' ? el.checked : el.value;
                });
                return data;
            }

            function loadFormData(data) {
                assessmentForm.reset();
                for (const key in data) {
                    const el = document.getElementById(key);
                    if (el) el.type === 'checkbox' ? el.checked = data[key] : el.value = data[key];
                }
                // Placeholder for dynamic inputs like devices/bloods etc.
            }

            function saveActivePatientData() {
                if (!activePatientId) return;
                const patientData = getFormData();
                const patientName = patientData.patientInitials || `Patient`;
                // Score calculation placeholder
                const score = 0; 
                patients[activePatientId] = {
                    id: activePatientId,
                    name: patientName,
                    score: score,
                    categoryClass: 'risk-single',
                    categoryText: 'At least one follow-up review required',
                    data: patientData
                };
                saveState();
                renderTabs();
            }

            function addPatient(doSave = true) {
                const newId = `patient_${Date.now()}`;
                const newPatientName = `Patient ${Object.keys(patients).length + 1}`;
                patients[newId] = { id: newId, name: newPatientName, score: 0, categoryClass: 'risk-single', categoryText: 'At least one follow-up review required', data: {} };
                activePatientId = newId;
                if(doSave) saveState();
                switchPatient(newId);
            }

            function deletePatient(idToDelete) {
                delete patients[idToDelete];
                if (Object.keys(patients).length === 0) {
                    addPatient(false);
                } else {
                    if (activePatientId === idToDelete) { activePatientId = Object.keys(patients)[0]; }
                    saveState();
                    switchPatient(activePatientId);
                }
            }

            function switchPatient(newId) {
                if (activePatientId && patients[activePatientId] && activePatientId !== newId) { saveActivePatientData(); }
                activePatientId = newId;
                const patient = patients[newId];
                if (patient) { loadFormData(patient.data); }
                renderTabs();
            }

            function renderTabs() {
                patientTabsContainer.querySelectorAll('.patient-tab').forEach(tab => tab.remove());
                const patientCount = Object.keys(patients).length;
                tabsPlaceholder.style.display = patientCount === 0 ? 'block' : 'none';
                Object.values(patients).forEach(patient => {
                    const tab = document.createElement('div');
                    tab.className = `patient-tab ${patient.id === activePatientId ? 'active ' + patient.categoryClass : ''}`;
                    tab.dataset.id = patient.id;
                    tab.innerHTML = `<span class="tab-score-badge" style="background-color: ${categoryColorMap[patient.categoryClass]}">${patient.score || 0}</span> <span>${patient.name}</span>`;
                    const deleteBtn = document.createElement('button');
                    deleteBtn.innerHTML = '&times;';
                    deleteBtn.className = 'delete-patient-btn';
                    deleteBtn.dataset.id = patient.id;
                    tab.appendChild(deleteBtn);
                    tab.onclick = () => switchPatient(patient.id);
                    patientTabsContainer.appendChild(tab);
                });
            }

            function generateSummary() {
                const data = getFormData();
                // Placeholder logic for generating a comprehensive summary
                emrSummaryEl.value = `Patient: ${data.patientInitials}\nWard: ${data.wardAndRoom}\nLOS: ${data.losDays} days\n\n[Full assessment summary based on all form inputs here]`;
            }

            function copySummary() {
                if (!emrSummaryEl.value) { alert('Please generate the summary first.'); return; }
                navigator.clipboard.writeText(emrSummaryEl.value).then(() => {
                    copySummaryButton.textContent = 'Copied!';
                    setTimeout(() => { copySummaryButton.textContent = 'Copy to Clipboard'; }, 2000);
                }).catch(err => alert('Failed to copy.'));
            }

            function showQrCode() {
                saveActivePatientData();
                const allPatientsData = Object.values(patients);
                const jsonString = JSON.stringify(allPatientsData);
                const encodedData = btoa(jsonString);
                const finalUrl = `${QR_BASE_URL}?data=${encodedData}`;
                qrcodeContainer.innerHTML = '';
                QRCode.toCanvas(qrcodeContainer, finalUrl, function (error) {
                    if (error) console.error(error);
                });
                qrOverlay.classList.remove('hidden');
            }

            function startScan() {
                // This would normally activate a camera scanner library like html5-qrcode
                alert('Simulating QR scan. On a real device, this would open the camera.');
                // For demonstration, let's simulate a QR scan loading data
                // This would be replaced by the actual QR scanner logic
                const sampleData = [{"id":"patient_1672531200000","name":"J.D.","score":0,"categoryClass":"risk-single","categoryText":"At least one follow-up review required","data":{"patientInitials":"J.D.","wardAndRoom":"A-102","losDays":"3"}}, {"id":"patient_1672531201000","name":"E.F.","score":0,"categoryClass":"risk-single","categoryText":"At least one follow-up review required","data":{"patientInitials":"E.F.","wardAndRoom":"B-201","losDays":"5"}}];
                const encodedData = btoa(JSON.stringify(sampleData));
                const mockUrl = `${QR_BASE_URL}?data=${encodedData}`;
                window.location.href = mockUrl;
            }

            function handleInitialView() {
                if (isMobile) {
                    mainFormContainer.style.display = 'none';
                    mobileStartScreen.style.display = 'block';
                } else {
                    mainFormContainer.style.display = 'block';
                    mobileStartScreen.style.display = 'none';
                }
            }
            
            // --- Event Listeners ---
            addPatientBtn.addEventListener('click', () => addPatient());
            clearDataBtn.addEventListener('click', () => { if(confirm('Are you sure you want to delete all patient data?')) { localStorage.removeItem(LOCAL_STORAGE_KEY); patients = {}; activePatientId = null; addPatient(false); } });
            sendToMobileBtn.addEventListener('click', () => showQrCode());
            closeQrBtn.addEventListener('click', () => qrOverlay.classList.add('hidden'));
            generateSummaryButton.addEventListener('click', () => generateSummary());
            copySummaryButton.addEventListener('click', () => copySummary());
            
            if (isMobile) {
                startNewBtn.addEventListener('click', () => {
                    mainFormContainer.style.display = 'block';
                    mobileStartScreen.style.display = 'none';
                    loadAllData();
                });
                scanQrBtn.addEventListener('click', () => startScan());
            }

            patientTabsContainer.addEventListener('click', e => {
                const target = e.target.closest('.patient-tab');
                if (target) {
                    const id = target.dataset.id;
                    if (e.target.classList.contains('delete-patient-btn')) {
                        e.stopPropagation();
                        if (confirm(`Are you sure you want to delete patient ${patients[id]?.name || 'this patient'}?`)) {
                            deletePatient(id);
                        }
                    } else {
                        switchPatient(id);
                    }
                }
            });
            
            assessmentForm.addEventListener('input', () => { saveActivePatientData(); });

            // Initial load logic
            handleInitialView();
            loadAllData();
        });
    </script>
</body>
</html>
